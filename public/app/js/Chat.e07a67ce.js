(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Chat"],{"293a":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("MainLayout",{attrs:{"is-show-header":!e.showJobDetailsMob}},[a("twilio-chat")],1)},n=[],r=a("5530"),i=a("713b"),c=(a("09f9"),a("2f62")),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chat_page"},[s("div",{staticClass:"container_chat"},[e.user_guest?s("div",{staticClass:"header_chat"},[s("div",{staticClass:"guest_avatar"},[e.getGuestAvatarUser()?s("img",{staticClass:"guest_avatar",attrs:{src:e.getGuestAvatarUser(),alt:""}}):s("img",{staticClass:"guest_avatar",attrs:{src:a("346f"),alt:""}})]),s("div",{staticClass:"ms-3 name_title"},[e._v(e._s(e.user_guest.first_name)+" "+e._s(e.user_guest.last_name))])]):e._e(),s("div",{ref:"messagesContainer",staticClass:"message-box",on:{scroll:e.onScrollChat}},e._l(e.messages,(function(t){return e.messages.length?s("div",{key:t.id,staticClass:"message_div",class:{message_div_end:t.author==e.user.id}},[t.author!=e.user.id?s("div",{staticClass:"box_avatar"},[e.getAvatarUser(t.author)?s("img",{staticClass:"avatar",attrs:{src:e.getAvatarUser(t.author),alt:""}}):s("img",{staticClass:"avatar",attrs:{src:a("346f"),alt:""}})]):e._e(),s("div",{staticClass:"message_item",class:{my_message:t.author==e.user.id}},[e.isImageChatMessage(t)?[e.getMessageContent(t)?s("img",{staticClass:"chat_image cp",attrs:{src:e.getMessageContent(t),preview:"0","preview-text":"",alt:"chat image"}}):e._e()]:[s("div",{},[e._v(e._s(e.getMessageContent(t)))])]],2)]):e._e()})),0),s("div",{staticClass:"input_box_s"},[s("input",{attrs:{type:"file",id:"upload-file",accept:"image/jpeg, image/gif, image/png"},on:{change:e.saveImage}}),s("img",{staticClass:"img_m chat",attrs:{src:a("a00d")},on:{click:e.loadFile}}),s("input",{directives:[{name:"model",rawName:"v-model",value:e.newMessage,expression:"newMessage"}],staticClass:"input_send_m",attrs:{type:"text",placeholder:"Type..."},domProps:{value:e.newMessage},on:{keyup:function(t){return t.type.indexOf("key")||13===t.keyCode?e.sendMessage.apply(null,arguments):null},input:function(t){t.target.composing||(e.newMessage=t.target.value)}}})])])])},u=[],l=a("1da1"),d=(a("d3b7"),a("159b"),a("e9c4"),a("96cf"),a("96f0")),h={name:"TwilioChat",components:{},data:function(){return{job_id:this.$route.params.id,user:{},chat_client:null,channel:null,connected:!1,messages:[],newMessage:"",showMessages:!1,users_chat:[],user_guest:{},auto_scroll:!0}},mounted:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.user=JSON.parse(localStorage.getItem("strobeart_user"))||{},e.connectClientWithUsername();case 2:case"end":return t.stop()}}),t)})))()},created:function(){this.$previewRefresh()},updated:function(){this.$previewRefresh(),this.scrollToEnd()},computed:Object(r["a"])({},Object(c["b"])(["getUser"])),methods:Object(r["a"])(Object(r["a"])({},Object(c["c"])(["showLoader","hideLoader"])),{},{onScrollChat:function(){var e=this.$refs.messagesContainer;e.scrollHeight-Math.abs(e.scrollTop)===e.clientHeight?this.auto_scroll=!0:this.auto_scroll=!1},scrollToEnd:function(){var e=this.$refs.messagesContainer;this.auto_scroll&&(e.scrollTop=e.scrollHeight)},getGuestAvatarUser:function(){var e,t;return(null===(e=this.user_guest)||void 0===e||null===(t=e.avatar)||void 0===t?void 0:t.url)||null},getAvatarUser:function(e){var t,a;return(null===(t=this.users_chat[e])||void 0===t||null===(a=t.avatar)||void 0===a?void 0:a.url)||null},connectClientWithUsername:function(){var e,t;null!==(e=this.user)&&void 0!==e&&e.id?this.fetchAccessToken(null===(t=this.user)||void 0===t?void 0:t.id,this.connectMessagingClient):console.log("Error User")},fetchAccessToken:function(e,t){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var s,n,r,i,c,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a.showLoader(),e.prev=1,e.next=4,a.$http.postAuth("".concat(a.$http.apiUrl(),"access_token"),{identity:null===(s=a.user)||void 0===s?void 0:s.id});case 4:return i=e.sent,e.next=7,a.$http.postAuth("".concat(a.$http.apiUrl(),"chat"),{job_id:a.job_id});case 7:c=e.sent,null!==c&&void 0!==c&&null!==(n=c.data)&&void 0!==n&&n.data&&(o=c.data.data,o.forEach((function(e){a.users_chat[e.id]=e,e.id!=a.user.id&&(a.user_guest=e)}))),a.hideLoader(),t(null===i||void 0===i||null===(r=i.data)||void 0===r?void 0:r.data),e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](1),console.log(error);case 16:a.hideLoader();case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))()},identityUser:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=e.channel.getMembers(),a.then((function(t){t.forEach((function(t){t.identity==e.user.id&&e.channel.setAllMessagesConsumed()}))}));case 2:case"end":return t.stop()}}),t)})))()},connectMessagingClient:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var s,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t,a.next=3,d.Client.create(e);case 3:return t.chat_client=a.sent,t.chat_client.on("tokenAboutToExpire",Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s.refreshToken();case 1:case"end":return e.stop()}}),e)})))),s.updateConnectedUI(),a.prev=6,n="channel-"+t.job_id,a.next=10,t.chat_client.getChannelByUniqueName(n);case 10:return t.channel=a.sent,t.channel.on("messageAdded",(function(e){t.messages.push(e),t.identityUser()})),a.next=14,t.identityUser();case 14:return t.channel.getUnconsumedMessagesCount().then((function(e){console.log("res",e)})),console.log(t.channel.lastConsumedMessageIndex),a.next=18,t.fetchMessages();case 18:a.next=23;break;case 20:a.prev=20,a.t0=a["catch"](6),console.log("await this.chat_client.getChannelByUniqueName(name); ERR:",a.t0);case 23:case"end":return a.stop()}}),a,null,[[6,20]])})))()},sendEmailUser:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.showLoader(),t.prev=1,t.next=4,e.$http.postAuth("".concat(e.$http.apiUrl(),"send-email"),{email:(null===(a=e.user_guest)||void 0===a?void 0:a.email)||"",text:e.newMessage,link:e.$route.path});case 4:t.next=8;break;case 6:t.prev=6,t.t0=t["catch"](1);case 8:e.hideLoader();case 9:case"end":return t.stop()}}),t,null,[[1,6]])})))()},sendMessage:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.newMessage){t.next=2;break}return t.abrupt("return");case 2:return a={message:e.newMessage,url:null},e.channel.sendMessage(JSON.stringify(a)),t.next=6,e.sendEmailUser();case 6:e.newMessage="";case 7:case"end":return t.stop()}}),t)})))()},fetchMessages:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.channel.getMessages();case 3:a=t.sent,e.messages=a.items,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("await this.channel.getMessages() ERROR:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},updateConnectedUI:function(){this.connected=!0},refreshToken:function(){var e;this.fetchAccessToken(null===(e=this.user)||void 0===e?void 0:e.id,this.setNewToken)},setNewToken:function(e){this.chat_client.updateToken(e.token)},isImageChatMessage:function(e){try{var t=JSON.parse(e.body);return!(!t||!t.url)}catch(a){return!1}},loadFile:function(){document.getElementById("upload-file").click()},saveImage:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var a,s,n,r,i,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=new FormData,a.append("image",document.getElementById("upload-file").files[0]),a.append("job_id",e.job_id),e.showLoader(),t.prev=4,t.next=7,e.$http.postAuth("".concat(e.$http.apiUrl(),"chat/image"),a,e.$http.formDataHeader());case 7:r=t.sent,i=r.data,null!==i&&void 0!==i&&null!==(s=i.data)&&void 0!==s&&null!==(n=s.image)&&void 0!==n&&n.url&&(c={message:null,url:i.data.image.url},e.channel.sendMessage(JSON.stringify(c))),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](4),console.log("saveImage ERR:",t.t0);case 15:e.hideLoader();case 16:case"end":return t.stop()}}),t,null,[[4,12]])})))()},getMessageContent:function(e){try{var t=this.isImageChatMessage(e),a=JSON.parse(e.body);return t?a["url"]:a["message"]}catch(s){return e.body}}})},v=h,g=(a("c470"),a("2877")),p=Object(g["a"])(v,o,u,!1,null,"a67ef810",null),m=p.exports,f={name:"Chat",components:{MainLayout:i["a"],TwilioChat:m},data:function(){return{}},mounted:function(){},methods:Object(r["a"])(Object(r["a"])({},Object(c["c"])(["showLoader","hideLoader"])),{},{isMobile:function(){return window.innerWidth<=992}}),computed:{showJobDetailsMob:function(){return this.isMobile()}}},_=f,b=Object(g["a"])(_,s,n,!1,null,"a5366bce",null);t["default"]=b.exports},3165:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("MainLayout",{attrs:{"is-show-header":!e.showJobDetailsMob}},[s("div",{staticClass:"page_list_channels"},[s("div",{staticClass:"items_chat"},[s("div",{staticClass:"title_page mb-3"},[e._v("Messages")]),s("div",{staticClass:"box_search_i"},[s("input",{staticClass:"search_chat_inp",attrs:{type:"text",placeholder:""},on:{keyup:e.keypressSearchChat}}),s("img",{staticClass:"search_icon",attrs:{src:a("d103"),alt:""}})]),e._l(e.chats_list_filter,(function(t){return s("div",{staticClass:"channel_item",on:{click:function(a){return e.goChat(t.job_image_id)}}},[s("div",{staticClass:"chat_item"},[s("div",{staticClass:"box_avatar"},[e.getAvatarUser(t)?s("img",{staticClass:"avatar",attrs:{src:e.getAvatarUser(t),alt:""}}):s("img",{staticClass:"avatar",attrs:{src:a("346f"),alt:""}})]),s("div",{staticClass:"ps-3"},[s("div",{staticClass:" user_title"},[e._v(" "+e._s(e.getUser(t).first_name)+" "+e._s(e.getUser(t).last_name)+" "),s("div",{staticClass:"job_t"},[e._v(e._s(e.styleGuideJob(t)))])])])]),s("div",{staticClass:"date_box"},[s("div",[e._v(e._s(e.getDateCreatedChat(t.created_at)))])]),s("div",{staticClass:"icon_a"},[s("img",{attrs:{src:a("eb5e"),alt:""}})])])}))],2)])])},n=[],r=a("1da1"),i=a("5530"),c=(a("96cf"),a("4de4"),a("d3b7"),a("caad"),a("2532"),a("b0c0"),a("713b")),o=(a("09f9"),a("7f45")),u=a.n(o),l=a("2f62"),d=(a("96f0"),{name:"ChatsList",components:{MainLayout:c["a"]},data:function(){return{user:{},chats_list:{},chats_list_filter:{}}},mounted:function(){this.user=JSON.parse(localStorage.getItem("strobeart_user"))||{},this.chatsList()},methods:Object(i["a"])(Object(i["a"])({},Object(l["c"])(["showLoader","hideLoader"])),{},{getDateCreatedChat:function(e){return u()(e).format("MM/DD/yyyy")},styleGuideJob:function(e){var t;return(null===e||void 0===e||null===(t=e.job_image)||void 0===t?void 0:t.style_guide)||""},isMobile:function(){return window.innerWidth<=992},goChat:function(e){this.$router.push({name:"Chat",params:{id:e}}).then()},getAvatarUser:function(e){var t,a,s,n,r;return"business"==(null===(t=this.user)||void 0===t?void 0:t.type_user)?(null===e||void 0===e||null===(a=e.user_editor)||void 0===a||null===(s=a.avatar)||void 0===s?void 0:s.url)||null:(null===e||void 0===e||null===(n=e.user_business)||void 0===n||null===(r=n.avatar)||void 0===r?void 0:r.url)||null},getUser:function(e){var t;return"business"==(null===(t=this.user)||void 0===t?void 0:t.type_user)?(null===e||void 0===e?void 0:e.user_editor)||{}:(null===e||void 0===e?void 0:e.user_business)||{}},keypressSearchChat:function(e){var t,a=e.target.value.toUpperCase();a&&a.length>1?"business"==(null===(t=this.user)||void 0===t?void 0:t.type_user)?this.chats_list_filter=this.chats_list.filter((function(e){return e.user_editor.name.toUpperCase().includes(a)})):this.chats_list_filter=this.chats_list.filter((function(e){return e.user_business.name.toUpperCase().includes(a)})):this.chats_list_filter=this.chats_list},chatsList:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.showLoader(),t.prev=1,t.next=4,e.$http.getAuth("".concat(e.$http.apiUrl(),"chats-list"));case 4:n=t.sent,e.chats_list=null===n||void 0===n||null===(a=n.data)||void 0===a?void 0:a.data,e.chats_list_filter=null===n||void 0===n||null===(s=n.data)||void 0===s?void 0:s.data,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](1),console.log(error);case 12:e.hideLoader();case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()}}),computed:{showJobDetailsMob:function(){return this.isMobile()}}}),h=d,v=(a("98c9"),a("2877")),g=Object(v["a"])(h,s,n,!1,null,"57cee44e",null);t["default"]=g.exports},"98c9":function(e,t,a){"use strict";a("dfda")},a00d:function(e,t,a){e.exports=a.p+"img/uil_camera-plus.944439f8.svg"},c470:function(e,t,a){"use strict";a("cf50")},cf50:function(e,t,a){},dfda:function(e,t,a){},eb5e:function(e,t,a){e.exports=a.p+"img/ep_arrow-right.d3a55d18.svg"}}]);
//# sourceMappingURL=Chat.e07a67ce.js.map